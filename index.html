<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>La Mia PWA</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="La Mia PWA">
    
    <!-- Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkxhIE1pYSBQV0EiLAogICJzaG9ydF9uYW1lIjogIk15UFdBIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmZmZmZmYiLAogICJ0aGVtZV9jb2xvciI6ICIjMjU2M2ViIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M00zUnZjbWN2TWpBd01DOXpkbWNpSUhacFpYZENiM2c5SWpBZ01DQTFNVElnTlRFeUlpQjNhV1IwYUQwaU5URXlJaUJvWldsbmFIUTlJalV4TWlJK1BHTnBjbU5zWlNCamVEMGlNalUySWlCamVUMGlNalUySWlCeVBTSXlOVFlpSUdacGJHdHpJalF4TURFNU1ERXNJa1pHUmtaR1JpSWdMejQ4TDNOMlp6ND0iLAogICAgICAic2l6ZXMiOiAiNTEyeDUxMiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            height: 100dvh; /* Dynamic viewport height per dispositivi mobili */
            background: #f5f5f5;
        }

        /* Header */
        .app-header {
            background: #1976d2;
            padding: env(safe-area-inset-top, 20px) 20px 15px 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: white;
        }

        .app-title {
            font-size: 20px;
            font-weight: 600;
        }

        .menu-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background-color 0.2s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu-btn:active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            overflow: hidden;
            padding: 16px;
            background: #f5f5f5;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .content-card {
            background: #ffffff;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 0; /* Importante per flexbox */
            transition: box-shadow 0.2s ease;
        }

        .content-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .card-title {
            font-size: 20px;
            font-weight: 500;
            color: #212121;
            margin-bottom: 8px;
        }

        .card-text {
            color: #757575;
            line-height: 1.5;
            margin-bottom: 12px;
            font-size: 14px;
            flex: 1;
            display: flex;
            align-items: center;
        }

        .action-btn {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
            margin-right: 8px;
            margin-bottom: 8px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .action-btn:hover {
            background: #1565c0;
            box-shadow: 0 2px 4px rgba(25, 118, 210, 0.3);
        }

        .action-btn:active {
            background: #0d47a1;
        }

        /* Footer */
        .app-footer {
            background: #ffffff;
            padding: 8px 0 calc(env(safe-area-inset-bottom, 0px) + 8px);
            border-top: 1px solid #e0e0e0;
            flex-shrink: 0;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
        }

        .footer-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #757575;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 4px;
            transition: color 0.2s, background-color 0.2s;
            font-size: 12px;
            font-weight: 500;
            flex: 1;
        }

        .nav-item:hover {
            background-color: rgba(25, 118, 210, 0.08);
            color: #1976d2;
        }

        .nav-item.active {
            color: #1976d2;
        }

        .nav-icon {
            font-size: 22px;
            margin-bottom: 4px;
        }

        /* Loading Animation */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e0e0e0;
            border-radius: 50%;
            border-top-color: #1976d2;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive adjustments */
        @media (max-width: 480px) {
            .main-content {
                padding: 12px;
                gap: 8px;
            }
            
            .content-card {
                padding: 12px;
            }
            
            .card-title {
                font-size: 18px;
                margin-bottom: 6px;
            }
            
            .card-text {
                font-size: 13px;
                line-height: 1.4;
            }
            
            .action-btn {
                padding: 8px 12px;
                font-size: 13px;
            }
        }

        @media (max-height: 600px) {
            .main-content {
                padding: 8px;
                gap: 6px;
            }
            
            .content-card {
                padding: 10px;
            }
            
            .card-title {
                font-size: 16px;
                margin-bottom: 4px;
            }
            
            .card-text {
                font-size: 12px;
                margin-bottom: 8px;
            }
            
            .action-btn {
                padding: 6px 10px;
                font-size: 12px;
            }
        }

        /* Floating Action Button Style */
        .fab {
            position: fixed;
            bottom: 80px;
            right: 16px;
            width: 56px;
            height: 56px;
            background: #1976d2;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            background: #1565c0;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            transform: scale(1.05);
        }

        /* Input Material Style */
        .material-input {
            width: 100%;
            padding: 12px 0 8px 0;
            border: none;
            border-bottom: 2px solid #e0e0e0;
            background: transparent;
            font-size: 16px;
            color: #212121;
            outline: none;
            transition: border-color 0.2s;
        }

        .material-input:focus {
            border-bottom-color: #1976d2;
        }

        .material-input::placeholder {
            color: #9e9e9e;
        }

        /* Status bar style for iOS */
        @supports (-webkit-appearance: none) {
            .app-header {
                padding-top: max(env(safe-area-inset-top), 20px);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">La Mia PWA</h1>
                <button class="menu-btn" onclick="toggleMenu()">☰</button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <div class="content-card">
                <h2 class="card-title">Benvenuto!</h2>
                <p class="card-text">
                    PWA Material Design che utilizza tutto lo spazio disponibile del display mobile senza scroll.
                </p>
                <div>
                    <button class="action-btn" onclick="loadContent('home')">Inizia</button>
                    <button class="action-btn" onclick="loadContent('features')">Funzionalità</button>
                </div>
            </div>

            <div class="content-card">
                <h2 class="card-title">Material Design</h2>
                <p class="card-text">
                    Clean • Responsive • Shadows • Typography • Colors
                </p>
            </div>

            <div class="content-card">
                <h2 class="card-title">PWA Status</h2>
                <p class="card-text" id="pwaStatus">
                    Controllando le funzionalità PWA...
                </p>
                <div>
                    <button class="action-btn" onclick="installPWA()" id="installBtn" style="display: none;">
                        Installa App
                    </button>
                </div>
            </div>
        </main>

        <!-- Footer Navigation -->
        <footer class="app-footer">
            <nav class="footer-nav">
                <a href="#" class="nav-item active" onclick="setActiveTab(this, 'home')">
                    <span class="nav-icon">🏠</span>
                    <span>Home</span>
                </a>
                <a href="#" class="nav-item" onclick="setActiveTab(this, 'search')">
                    <span class="nav-icon">🔍</span>
                    <span>Cerca</span>
                </a>
                <a href="#" class="nav-item" onclick="setActiveTab(this, 'notifications')">
                    <span class="nav-icon">🔔</span>
                    <span>Notifiche</span>
                </a>
                <a href="#" class="nav-item" onclick="setActiveTab(this, 'profile')">
                    <span class="nav-icon">👤</span>
                    <span>Profilo</span>
                </a>
            </nav>
        </footer>
    </div>

    <script>
        let deferredPrompt;
        let currentContent = 'home';

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('data:text/javascript;base64,Y29uc3QgQ0FDSEVfTkFNRSA9ICdteS1wd2EtdjEnOwpjb25zdCB1cmxzVG9DYWNoZSA9IFsKICAnLycsCiAgJy9pbmRleC5odG1sJwpdOwoKc2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4gewogIGV2ZW50LndhaXRVbnRpbCgKICAgIGNhY2hlcy5vcGVuKENBQ0hFX05BTUUpCiAgICAgIC50aGVuKGNhY2hlID0+IGNhY2hlLmFkZEFsbCh1cmxzVG9DYWNoZSkpCiAgKTsKfSk7CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgZXZlbnQgPT4gewogIGV2ZW50LnJlc3BvbmRXaXRoKAogICAgY2FjaGVzLm1hdGNoKGV2ZW50LnJlcXVlc3QpCiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlIHx8IGZldGNoKGV2ZW50LnJlcXVlc3QpKQogICk7Cn0pOw==')
                .then(registration => {
                    console.log('SW registrato:', registration);
                })
                .catch(error => {
                    console.log('SW registration fallita:', error);
                });
            });
        }

        // PWA Install Prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBtn').style.display = 'inline-block';
            updatePWAStatus('App pronta per l\'installazione!');
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        updatePWAStatus('App installata con successo!');
                    }
                    deferredPrompt = null;
                    document.getElementById('installBtn').style.display = 'none';
                });
            }
        }

        function updatePWAStatus(message) {
            document.getElementById('pwaStatus').textContent = message;
        }

        // Navigation
        function setActiveTab(element, tab) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            element.classList.add('active');
            loadContent(tab);
        }

        function loadContent(section) {
            const mainContent = document.getElementById('mainContent');
            currentContent = section;
            
            // Show loading
            mainContent.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            // Simulate content loading
            setTimeout(() => {
                let content = '';
                
                switch(section) {
                    case 'home':
                        content = `
                            <div class="content-card">
                                <h2 class="card-title">Dashboard</h2>
                                <p class="card-text">Benvenuto nella tua dashboard personale.</p>
                                <div>
                                    <button class="action-btn" onclick="showNotification()">Notifica</button>
                                </div>
                            </div>
                            <div class="content-card">
                                <h2 class="card-title">Statistiche</h2>
                                <p class="card-text">📊 Sessioni: 5 • ⏱️ Tempo: 2h 30m • 🎯 Obiettivo: 80%</p>
                            </div>
                        `;
                        break;
                    case 'search':
                        content = `
                            <div class="content-card">
                                <h2 class="card-title">Ricerca</h2>
                                <p class="card-text">Cosa stai cercando?</p>
                                <div>
                                    <input type="text" placeholder="Inserisci termine..." class="material-input">
                                </div>
                            </div>
                            <div class="content-card">
                                <h2 class="card-title">Risultati</h2>
                                <p class="card-text">I risultati di ricerca appariranno qui.</p>
                            </div>
                        `;
                        break;
                    case 'notifications':
                        content = `
                            <div class="content-card">
                                <h2 class="card-title">Notifiche Recenti</h2>
                                <p class="card-text">🔔 Nuova funzionalità • 📱 App aggiornata • 🎉 Benvenuto!</p>
                            </div>
                        `;
                        break;
                    case 'profile':
                        content = `
                            <div class="content-card">
                                <h2 class="card-title">Il Tuo Profilo</h2>
                                <p class="card-text">👤 Utente Demo • 📧 demo@example.com • 📱 ${navigator.userAgent.includes('Mobile') ? 'Mobile' : 'Desktop'}</p>
                                <div>
                                    <button class="action-btn" onclick="toggleTheme()">Cambia Tema</button>
                                </div>
                            </div>
                        `;
                        break;
                    default:
                        content = `
                            <div class="content-card">
                                <h2 class="card-title">Sezione ${section}</h2>
                                <p class="card-text">Contenuto per la sezione ${section}.</p>
                            </div>
                        `;
                }
                
                mainContent.innerHTML = content;
            }, 500);
        }

        function toggleMenu() {
            alert('Menu aperto! Qui potresti implementare un menu laterale o modale.');
        }

        function showNotification() {
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    new Notification('Ciao dalla PWA!', {
                        body: 'Questa è una notifica di esempio.',
                        icon: 'data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNTYiIHI9IjI1NiIgZmlsbD0iIzQxOTE5MSIvPjwvc3ZnPg=='
                    });
                } else if (Notification.permission !== 'denied') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            new Notification('Notifiche abilitate!');
                        }
                    });
                }
            } else {
                alert('Le notifiche non sono supportate in questo browser.');
            }
        }

        function toggleTheme() {
            const container = document.querySelector('.app-container');
            const header = document.querySelector('.app-header');
            const footer = document.querySelector('.app-footer');
            const cards = document.querySelectorAll('.content-card');
            
            const isDark = container.classList.contains('dark-theme');
            
            if (isDark) {
                // Light theme
                container.classList.remove('dark-theme');
                container.style.background = '#f5f5f5';
                header.style.background = '#1976d2';
                footer.style.background = '#ffffff';
                footer.style.borderColor = '#e0e0e0';
                cards.forEach(card => {
                    card.style.background = '#ffffff';
                    card.style.color = '#212121';
                });
            } else {
                // Dark theme
                container.classList.add('dark-theme');
                container.style.background = '#121212';
                header.style.background = '#1f1f1f';
                footer.style.background = '#1f1f1f';
                footer.style.borderColor = '#333333';
                cards.forEach(card => {
                    card.style.background = '#1e1e1e';
                    card.style.color = '#ffffff';
                });
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updatePWAStatus('PWA caricata e pronta!');
            
            // Check if running as standalone app
            if (window.matchMedia('(display-mode: standalone)').matches) {
                updatePWAStatus('App in esecuzione in modalità standalone!');
            }
        });

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
